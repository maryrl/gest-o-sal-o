
<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Agendamentos - Sal√£o de Beleza</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script><!-- Firebase SDK -->
  <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        
        // Firebase configuration (substitua pelas suas credenciais)
        const firebaseConfig = {
            apiKey: "demo-api-key",
            authDomain: "demo-project.firebaseapp.com",
            projectId: "demo-project",
            storageBucket: "demo-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "demo-app-id"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        // Make auth available globally
        window.firebaseAuth = auth;
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.signOut = signOut;
        window.onAuthStateChanged = onAuthStateChanged;
    </script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .service-card:hover {
            transform: translateY(-5px);
            transition: all 0.3s ease;
        }
        
        .portfolio-item {
            position: relative;
            overflow: hidden;
            border-radius: 12px;
        }
        
        .portfolio-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            opacity: 0;
            transition: opacity 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .portfolio-item:hover .portfolio-overlay {
            opacity: 1;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: #10b981;
        }
        
        .notification.error {
            background: #ef4444;
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f4;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .admin-panel {
            background: #f8fafc;
            border-radius: 12px;
            padding: 24px;
            margin-top: 32px;
        }
        
        .appointment-card {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-agendado {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .status-confirmado {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-cancelado {
            background: #fee2e2;
            color: #991b1b;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full">
  <div id="notification" class="notification"></div><!-- Login Modal -->
  <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
   <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Login Administrativo</h2>
    <form id="login-form">
     <div class="mb-4"><label for="admin-email" class="block text-sm font-medium text-gray-700 mb-2">Email</label> <input type="email" id="admin-email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
     </div>
     <div class="mb-6"><label for="admin-password" class="block text-sm font-medium text-gray-700 mb-2">Senha</label> <input type="password" id="admin-password" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
     </div>
     <div class="flex space-x-4"><button type="button" onclick="hideLoginModal()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition-colors"> Cancelar </button> <button type="submit" id="login-btn" class="flex-1 bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition-colors flex items-center justify-center"> <span id="login-text">Entrar</span>
       <div id="login-spinner" class="loading-spinner ml-2 hidden"></div></button>
     </div>
    </form>
   </div>
  </div><!-- Header -->
  <header class="gradient-bg text-white py-6">
   <div class="container mx-auto px-4">
    <div class="flex justify-between items-center">
     <div>
      <h1 id="salon-title" class="text-3xl font-bold">Sal√£o Bella Vista</h1>
      <p id="welcome-text" class="text-lg opacity-90">Bem-vindo ao nosso sal√£o!</p>
     </div>
     <div class="text-right">
      <p id="salon-contact" class="text-sm opacity-80">üì± (11) 99999-9999</p><button id="auth-btn" onclick="showLoginModal()" class="mt-2 bg-white bg-opacity-20 px-4 py-2 rounded-lg hover:bg-opacity-30 transition-all"> Login Admin </button>
     </div>
    </div>
   </div>
  </header><!-- Navigation -->
  <nav class="bg-white shadow-md sticky top-0 z-50">
   <div class="container mx-auto px-4">
    <div class="flex justify-center space-x-8 py-4"><button onclick="showSection('home')" class="nav-btn text-gray-700 hover:text-purple-600 font-medium transition-colors"> üè† In√≠cio </button> <button onclick="showSection('services')" class="nav-btn text-gray-700 hover:text-purple-600 font-medium transition-colors"> ‚ú® Servi√ßos </button> <button onclick="showSection('portfolio')" class="nav-btn text-gray-700 hover:text-purple-600 font-medium transition-colors"> üì∏ Portf√≥lio </button> <button onclick="showSection('booking')" class="nav-btn text-gray-700 hover:text-purple-600 font-medium transition-colors"> üìÖ Agendar </button>
    </div>
   </div>
  </nav><!-- Home Section -->
  <section id="home-section" class="py-16 bg-gradient-to-br from-purple-50 to-pink-50">
   <div class="container mx-auto px-4 text-center">
    <h2 class="text-4xl font-bold text-gray-800 mb-6">Transforme sua Beleza</h2>
    <p class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">Oferecemos os melhores tratamentos de beleza com profissionais qualificados e produtos de alta qualidade.</p><button onclick="showSection('booking')" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-4 rounded-full text-lg font-semibold hover:shadow-lg transform hover:scale-105 transition-all"> Agende Agora </button>
   </div>
  </section><!-- Services Section -->
  <section id="services-section" class="py-16 bg-white hidden">
   <div class="container mx-auto px-4">
    <h2 class="text-3xl font-bold text-center text-gray-800 mb-12">Nossos Servi√ßos</h2>
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
     <div class="service-card bg-white rounded-xl shadow-lg p-6 border border-gray-100">
      <div class="text-4xl mb-4">
       üíá‚Äç‚ôÄÔ∏è
      </div>
      <h3 class="text-xl font-bold text-gray-800 mb-2">Corte Feminino</h3>
      <p class="text-gray-600 mb-4">Cortes modernos e personalizados para real√ßar sua beleza natural.</p>
      <p class="text-2xl font-bold text-purple-600">R$ 80</p>
     </div>
     <div class="service-card bg-white rounded-xl shadow-lg p-6 border border-gray-100">
      <div class="text-4xl mb-4">
       üé®
      </div>
      <h3 class="text-xl font-bold text-gray-800 mb-2">Colora√ß√£o</h3>
      <p class="text-gray-600 mb-4">Colora√ß√£o profissional com produtos de alta qualidade.</p>
      <p class="text-2xl font-bold text-purple-600">R$ 120</p>
     </div>
     <div class="service-card bg-white rounded-xl shadow-lg p-6 border border-gray-100">
      <div class="text-4xl mb-4">
       üíÖ
      </div>
      <h3 class="text-xl font-bold text-gray-800 mb-2">Manicure</h3>
      <p class="text-gray-600 mb-4">Cuidados completos para suas unhas com esmalta√ß√£o perfeita.</p>
      <p class="text-2xl font-bold text-purple-600">R$ 35</p>
     </div>
     <div class="service-card bg-white rounded-xl shadow-lg p-6 border border-gray-100">
      <div class="text-4xl mb-4">
       üëÅÔ∏è
      </div>
      <h3 class="text-xl font-bold text-gray-800 mb-2">Design de Sobrancelhas</h3>
      <p class="text-gray-600 mb-4">Modelagem perfeita para valorizar seu olhar.</p>
      <p class="text-2xl font-bold text-purple-600">R$ 45</p>
     </div>
     <div class="service-card bg-white rounded-xl shadow-lg p-6 border border-gray-100">
      <div class="text-4xl mb-4">
       ‚ú®
      </div>
      <h3 class="text-xl font-bold text-gray-800 mb-2">Hidrata√ß√£o</h3>
      <p class="text-gray-600 mb-4">Tratamentos intensivos para cabelos saud√°veis e brilhantes.</p>
      <p class="text-2xl font-bold text-purple-600">R$ 60</p>
     </div>
     <div class="service-card bg-white rounded-xl shadow-lg p-6 border border-gray-100">
      <div class="text-4xl mb-4">
       üíÜ‚Äç‚ôÄÔ∏è
      </div>
      <h3 class="text-xl font-bold text-gray-800 mb-2">Massagem Relaxante</h3>
      <p class="text-gray-600 mb-4">Momentos de relaxamento e bem-estar.</p>
      <p class="text-2xl font-bold text-purple-600">R$ 90</p>
     </div>
    </div>
   </div>
  </section><!-- Portfolio Section -->
  <section id="portfolio-section" class="py-16 bg-gray-50 hidden">
   <div class="container mx-auto px-4">
    <h2 class="text-3xl font-bold text-center text-gray-800 mb-12">Nossos Trabalhos</h2>
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
     <div class="portfolio-item bg-gradient-to-br from-purple-400 to-pink-400 h-64 rounded-xl">
      <div class="portfolio-overlay"><span>Corte Moderno</span>
      </div>
     </div>
     <div class="portfolio-item bg-gradient-to-br from-blue-400 to-purple-400 h-64 rounded-xl">
      <div class="portfolio-overlay"><span>Colora√ß√£o Especial</span>
      </div>
     </div>
     <div class="portfolio-item bg-gradient-to-br from-pink-400 to-red-400 h-64 rounded-xl">
      <div class="portfolio-overlay"><span>Design de Sobrancelhas</span>
      </div>
     </div>
     <div class="portfolio-item bg-gradient-to-br from-green-400 to-blue-400 h-64 rounded-xl">
      <div class="portfolio-overlay"><span>Manicure Art√≠stica</span>
      </div>
     </div>
     <div class="portfolio-item bg-gradient-to-br from-yellow-400 to-orange-400 h-64 rounded-xl">
      <div class="portfolio-overlay"><span>Hidrata√ß√£o Premium</span>
      </div>
     </div>
     <div class="portfolio-item bg-gradient-to-br from-indigo-400 to-purple-400 h-64 rounded-xl">
      <div class="portfolio-overlay"><span>Penteado para Eventos</span>
      </div>
     </div>
    </div>
   </div>
  </section><!-- Booking Section -->
  <section id="booking-section" class="py-16 bg-white hidden">
   <div class="container mx-auto px-4 max-w-2xl">
    <h2 class="text-3xl font-bold text-center text-gray-800 mb-12">Agende seu Hor√°rio</h2>
    <form id="booking-form" class="bg-white rounded-xl shadow-lg p-8 border border-gray-100">
     <div class="grid md:grid-cols-2 gap-6 mb-6">
      <div><label for="cliente-nome" class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label> <input type="text" id="cliente-nome" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
      </div>
      <div><label for="cliente-telefone" class="block text-sm font-medium text-gray-700 mb-2">WhatsApp</label> <input type="tel" id="cliente-telefone" required placeholder="(11) 99999-9999" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
      </div>
     </div>
     <div class="mb-6"><label for="cliente-email" class="block text-sm font-medium text-gray-700 mb-2">Email</label> <input type="email" id="cliente-email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
     </div>
     <div class="mb-6"><label for="servico" class="block text-sm font-medium text-gray-700 mb-2">Servi√ßo Desejado</label> <select id="servico" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"> <option value="">Selecione um servi√ßo</option> <option value="Corte Feminino - R$ 80">Corte Feminino - R$ 80</option> <option value="Colora√ß√£o - R$ 120">Colora√ß√£o - R$ 120</option> <option value="Manicure - R$ 35">Manicure - R$ 35</option> <option value="Design de Sobrancelhas - R$ 45">Design de Sobrancelhas - R$ 45</option> <option value="Hidrata√ß√£o - R$ 60">Hidrata√ß√£o - R$ 60</option> <option value="Massagem Relaxante - R$ 90">Massagem Relaxante - R$ 90</option> </select>
     </div>
     <div class="grid md:grid-cols-2 gap-6 mb-6">
      <div><label for="data" class="block text-sm font-medium text-gray-700 mb-2">Data Preferida</label> <input type="date" id="data" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
      </div>
      <div><label for="horario" class="block text-sm font-medium text-gray-700 mb-2">Hor√°rio</label> <select id="horario" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"> <option value="">Selecione um hor√°rio</option> <option value="09:00">09:00</option> <option value="10:00">10:00</option> <option value="11:00">11:00</option> <option value="14:00">14:00</option> <option value="15:00">15:00</option> <option value="16:00">16:00</option> <option value="17:00">17:00</option> </select>
      </div>
     </div>
     <div class="mb-6"><label for="observacoes" class="block text-sm font-medium text-gray-700 mb-2">Observa√ß√µes (opcional)</label> <textarea id="observacoes" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Alguma observa√ß√£o especial?"></textarea>
     </div><button type="submit" id="submit-btn" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-lg text-lg font-semibold hover:shadow-lg transform hover:scale-105 transition-all flex items-center justify-center"> <span id="submit-text">Confirmar Agendamento</span>
      <div id="submit-spinner" class="loading-spinner ml-2 hidden"></div></button>
    </form>
   </div>
  </section><!-- Admin Panel -->
  <div id="admin-panel" class="admin-panel container mx-auto px-4 hidden">
   <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-gray-800">Painel Administrativo</h2>
    <div class="flex space-x-4"><button onclick="exportToCalendar()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"> üìÖ Exportar Calend√°rio </button> <button onclick="sendReminders()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"> üìß Enviar Lembretes </button> <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors"> üö™ Sair </button>
    </div>
   </div>
   <div class="grid lg:grid-cols-3 gap-6 mb-8">
    <div class="bg-blue-100 p-6 rounded-lg text-center">
     <h3 class="text-2xl font-bold text-blue-800" id="total-agendamentos">0</h3>
     <p class="text-blue-600">Total de Agendamentos</p>
    </div>
    <div class="bg-green-100 p-6 rounded-lg text-center">
     <h3 class="text-2xl font-bold text-green-800" id="agendamentos-hoje">0</h3>
     <p class="text-green-600">Agendamentos Hoje</p>
    </div>
    <div class="bg-purple-100 p-6 rounded-lg text-center">
     <h3 class="text-2xl font-bold text-purple-800" id="receita-estimada">R$ 0</h3>
     <p class="text-purple-600">Receita Estimada</p>
    </div>
   </div>
   <div id="appointments-list"><!-- Appointments will be loaded here -->
   </div>
  </div>
  <script>
        // Configuration
        const defaultConfig = {
            salon_name: "Sal√£o Bella Vista",
            salon_phone: "(11) 99999-9999",
            salon_email: "contato@salao.com",
            welcome_message: "Bem-vindo ao nosso sal√£o!"
        };

        let appointments = [];
        let currentRecordCount = 0;
        let isAuthenticated = false;
        let bookedSlots = new Set(); // Para controlar hor√°rios ocupados

        // Data handler for SDK
        const dataHandler = {
            onDataChanged(data) {
                appointments = data;
                currentRecordCount = data.length;
                updateBookedSlots();
                updateAvailableHours();
                if (isAuthenticated) {
                    updateAdminStats();
                    renderAppointments();
                }
            }
        };

        // Element SDK implementation
        const elementImplementation = {
            defaultConfig,
            onConfigChange: async (config) => {
                const salonName = config.salon_name || defaultConfig.salon_name;
                const salonPhone = config.salon_phone || defaultConfig.salon_phone;
                const welcomeMessage = config.welcome_message || defaultConfig.welcome_message;

                document.getElementById('salon-title').textContent = salonName;
                document.getElementById('welcome-text').textContent = welcomeMessage;
                document.getElementById('salon-contact').textContent = `üì± ${salonPhone}`;
            },
            mapToCapabilities: (config) => ({
                recolorables: [
                    {
                        get: () => config.primary_color || "#667eea",
                        set: (value) => {
                            config.primary_color = value;
                            window.elementSdk.setConfig({ primary_color: value });
                        }
                    }
                ],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            }),
            mapToEditPanelValues: (config) => new Map([
                ["salon_name", config.salon_name || defaultConfig.salon_name],
                ["salon_phone", config.salon_phone || defaultConfig.salon_phone],
                ["salon_email", config.salon_email || defaultConfig.salon_email],
                ["welcome_message", config.welcome_message || defaultConfig.welcome_message]
            ])
        };

        // Initialize SDKs
        async function initializeApp() {
            try {
                if (window.dataSdk) {
                    const initResult = await window.dataSdk.init(dataHandler);
                    if (!initResult.isOk) {
                        console.error("Failed to initialize data SDK");
                    }
                }

                if (window.elementSdk) {
                    await window.elementSdk.init(elementImplementation);
                }

                // Set minimum date to today
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('data').min = today;

                // Initialize Firebase auth state listener
                if (window.onAuthStateChanged && window.firebaseAuth) {
                    window.onAuthStateChanged(window.firebaseAuth, (user) => {
                        if (user) {
                            isAuthenticated = true;
                            document.getElementById('auth-btn').textContent = 'Painel Admin';
                            document.getElementById('auth-btn').onclick = () => toggleAdminPanel();
                            updateAdminStats();
                            renderAppointments();
                        } else {
                            isAuthenticated = false;
                            document.getElementById('auth-btn').textContent = 'Login Admin';
                            document.getElementById('auth-btn').onclick = () => showLoginModal();
                            document.getElementById('admin-panel').classList.add('hidden');
                        }
                    });
                }
            } catch (error) {
                console.error("Initialization error:", error);
            }
        }

        // Authentication functions
        function showLoginModal() {
            document.getElementById('login-modal').classList.remove('hidden');
        }

        function hideLoginModal() {
            document.getElementById('login-modal').classList.add('hidden');
            document.getElementById('login-form').reset();
        }

        async function login(email, password) {
            if (!window.signInWithEmailAndPassword || !window.firebaseAuth) {
                // Fallback for demo purposes
                if (email === 'mari2000rodrigues@gmail.com' && password === 'M4ryrl04*') {
                    isAuthenticated = true;
                    document.getElementById('auth-btn').textContent = 'Painel Admin';
                    document.getElementById('auth-btn').onclick = () => toggleAdminPanel();
                    hideLoginModal();
                    showNotification('Login realizado com sucesso!');
                    updateAdminStats();
                    renderAppointments();
                    return true;
                } else {
                    throw new Error('Credenciais inv√°lidas');
                }
            }

            try {
                await window.signInWithEmailAndPassword(window.firebaseAuth, email, password);
                hideLoginModal();
                showNotification('Login realizado com sucesso!');
                return true;
            } catch (error) {
                throw new Error('Credenciais inv√°lidas');
            }
        }

        async function logout() {
            if (window.signOut && window.firebaseAuth) {
                await window.signOut(window.firebaseAuth);
            } else {
                // Fallback for demo
                isAuthenticated = false;
                document.getElementById('auth-btn').textContent = 'Login Admin';
                document.getElementById('auth-btn').onclick = () => showLoginModal();
                document.getElementById('admin-panel').classList.add('hidden');
            }
            showNotification('Logout realizado com sucesso!');
        }

        // Navigation
        function showSection(sectionName) {
            const sections = ['home', 'services', 'portfolio', 'booking'];
            sections.forEach(section => {
                const element = document.getElementById(`${section}-section`);
                if (element) {
                    element.classList.add('hidden');
                }
            });
            
            const targetSection = document.getElementById(`${sectionName}-section`);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }

            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-purple-600');
                btn.classList.add('text-gray-700');
            });
        }

        // Toggle admin panel
        function toggleAdminPanel() {
            if (isAuthenticated) {
                const panel = document.getElementById('admin-panel');
                panel.classList.toggle('hidden');
            } else {
                showLoginModal();
            }
        }

        // Update booked slots
        function updateBookedSlots() {
            bookedSlots.clear();
            appointments.forEach(appointment => {
                if (appointment.status !== 'cancelado') {
                    const slotKey = `${appointment.data}_${appointment.horario}`;
                    bookedSlots.add(slotKey);
                }
            });
        }

        // Update available hours based on selected date
        function updateAvailableHours() {
            const selectedDate = document.getElementById('data').value;
            const horarioSelect = document.getElementById('horario');
            
            if (!selectedDate) return;

            // Clear current options
            horarioSelect.innerHTML = '<option value="">Selecione um hor√°rio</option>';

            // Available time slots
            const timeSlots = ['09:00', '10:00', '11:00', '14:00', '15:00', '16:00', '17:00'];

            timeSlots.forEach(time => {
                const slotKey = `${selectedDate}_${time}`;
                const option = document.createElement('option');
                option.value = time;
                
                if (bookedSlots.has(slotKey)) {
                    option.textContent = `${time} - Ocupado`;
                    option.disabled = true;
                    option.style.color = '#999';
                } else {
                    option.textContent = time;
                }
                
                horarioSelect.appendChild(option);
            });
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Event listeners
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const loginBtn = document.getElementById('login-btn');
            const loginText = document.getElementById('login-text');
            const loginSpinner = document.getElementById('login-spinner');
            
            loginBtn.disabled = true;
            loginText.textContent = 'Entrando...';
            loginSpinner.classList.remove('hidden');
            
            try {
                const email = document.getElementById('admin-email').value;
                const password = document.getElementById('admin-password').value;
                await login(email, password);
            } catch (error) {
                showNotification(error.message, 'error');
            } finally {
                loginBtn.disabled = false;
                loginText.textContent = 'Entrar';
                loginSpinner.classList.add('hidden');
            }
        });

        // Date change listener
        document.getElementById('data').addEventListener('change', updateAvailableHours);

        // Form submission
        document.getElementById('booking-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (currentRecordCount >= 999) {
                showNotification('Limite m√°ximo de 999 agendamentos atingido. Entre em contato conosco.', 'error');
                return;
            }

            const submitBtn = document.getElementById('submit-btn');
            const submitText = document.getElementById('submit-text');
            const submitSpinner = document.getElementById('submit-spinner');
            
            // Show loading state
            submitBtn.disabled = true;
            submitText.textContent = 'Processando...';
            submitSpinner.classList.remove('hidden');

            try {
                const selectedDate = document.getElementById('data').value;
                const selectedTime = document.getElementById('horario').value;
                const slotKey = `${selectedDate}_${selectedTime}`;
                
                // Check if slot is already booked
                if (bookedSlots.has(slotKey)) {
                    showNotification('Este hor√°rio j√° est√° ocupado. Por favor, escolha outro hor√°rio.', 'error');
                    return;
                }

                const formData = {
                    id: Date.now().toString(),
                    cliente_nome: document.getElementById('cliente-nome').value,
                    cliente_telefone: document.getElementById('cliente-telefone').value,
                    cliente_email: document.getElementById('cliente-email').value,
                    servico: document.getElementById('servico').value,
                    data: selectedDate,
                    horario: selectedTime,
                    status: 'agendado',
                    observacoes: document.getElementById('observacoes').value,
                    created_at: new Date().toISOString()
                };

                if (window.dataSdk) {
                    const result = await window.dataSdk.create(formData);
                    
                    if (result.isOk) {
                        showNotification('Agendamento realizado com sucesso! Voc√™ receber√° uma confirma√ß√£o por WhatsApp e email.');
                        document.getElementById('booking-form').reset();
                        
                        // Simulate WhatsApp integration
                        setTimeout(() => {
                            const whatsappMessage = `Ol√° ${formData.cliente_nome}! Seu agendamento foi confirmado para ${formatDate(formData.data)} √†s ${formData.horario} - ${formData.servico}. Aguardamos voc√™! üíÑ‚ú®`;
                            const whatsappUrl = `https://wa.me/${formData.cliente_telefone.replace(/\D/g, '')}?text=${encodeURIComponent(whatsappMessage)}`;
                            window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
                        }, 1000);
                        
                    } else {
                        showNotification('Erro ao realizar agendamento. Tente novamente.', 'error');
                    }
                } else {
                    showNotification('Agendamento simulado realizado com sucesso!', 'success');
                    document.getElementById('booking-form').reset();
                }
            } catch (error) {
                showNotification('Erro ao processar agendamento. Tente novamente.', 'error');
            } finally {
                // Reset loading state
                submitBtn.disabled = false;
                submitText.textContent = 'Confirmar Agendamento';
                submitSpinner.classList.add('hidden');
            }
        });

        // Update admin stats
        function updateAdminStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayAppointments = appointments.filter(apt => apt.data === today);
            
            const totalRevenue = appointments.reduce((sum, apt) => {
                const price = apt.servico.match(/R\$ (\d+)/);
                return sum + (price ? parseInt(price[1]) : 0);
            }, 0);

            document.getElementById('total-agendamentos').textContent = appointments.length;
            document.getElementById('agendamentos-hoje').textContent = todayAppointments.length;
            document.getElementById('receita-estimada').textContent = `R$ ${totalRevenue}`;
        }

        // Render appointments
        function renderAppointments() {
            const container = document.getElementById('appointments-list');
            
            if (appointments.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhum agendamento encontrado.</p>';
                return;
            }

            const sortedAppointments = [...appointments].sort((a, b) => {
                const dateA = new Date(`${a.data} ${a.horario}`);
                const dateB = new Date(`${b.data} ${b.horario}`);
                return dateB - dateA;
            });

            container.innerHTML = sortedAppointments.map(appointment => `
                <div class="appointment-card">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-bold text-lg text-gray-800">${appointment.cliente_nome}</h3>
                            <p class="text-gray-600">${appointment.servico}</p>
                        </div>
                        <span class="status-badge status-${appointment.status}">${appointment.status}</span>
                    </div>
                    <div class="grid md:grid-cols-3 gap-4 text-sm text-gray-600 mb-3">
                        <div>üìÖ ${formatDate(appointment.data)}</div>
                        <div>üïê ${appointment.horario}</div>
                        <div>üì± ${appointment.cliente_telefone}</div>
                    </div>
                    <div class="text-sm text-gray-600 mb-3">
                        üìß ${appointment.cliente_email}
                    </div>
                    ${appointment.observacoes ? `<div class="text-sm text-gray-600 mb-3">üí¨ ${appointment.observacoes}</div>` : ''}
                    <div class="flex space-x-2">
                        <button onclick="updateAppointmentStatus('${appointment.__backendId}', 'confirmado')" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition-colors">
                            Confirmar
                        </button>
                        <button onclick="updateAppointmentStatus('${appointment.__backendId}', 'cancelado')" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition-colors">
                            Cancelar
                        </button>
                        <button onclick="sendWhatsAppMessage('${appointment.cliente_telefone}', '${appointment.cliente_nome}')" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition-colors">
                            WhatsApp
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Update appointment status
        async function updateAppointmentStatus(backendId, newStatus) {
            if (!isAuthenticated) {
                showNotification('Acesso negado. Fa√ßa login primeiro.', 'error');
                return;
            }

            const appointment = appointments.find(apt => apt.__backendId === backendId);
            if (!appointment) return;

            const updatedAppointment = { ...appointment, status: newStatus };

            if (window.dataSdk) {
                const result = await window.dataSdk.update(updatedAppointment);
                if (result.isOk) {
                    showNotification(`Status atualizado para ${newStatus}!`);
                    // Update booked slots when status changes
                    updateBookedSlots();
                    updateAvailableHours();
                } else {
                    showNotification('Erro ao atualizar status.', 'error');
                }
            }
        }

        // Send WhatsApp message
        function sendWhatsAppMessage(phone, name) {
            const message = `Ol√° ${name}! Este √© um lembrete do seu agendamento. Aguardamos voc√™! üíÑ‚ú®`;
            const whatsappUrl = `https://wa.me/${phone.replace(/\D/g, '')}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
        }

        // Export to calendar
        function exportToCalendar() {
            if (!isAuthenticated) {
                showNotification('Acesso negado. Fa√ßa login primeiro.', 'error');
                return;
            }
            const calendarEvents = appointments.map(apt => {
                const startDate = new Date(`${apt.data} ${apt.horario}`);
                const endDate = new Date(startDate.getTime() + 60 * 60 * 1000); // 1 hour duration
                
                return `BEGIN:VEVENT
DTSTART:${startDate.toISOString().replace(/[-:]/g, '').split('.')[0]}Z
DTEND:${endDate.toISOString().replace(/[-:]/g, '').split('.')[0]}Z
SUMMARY:${apt.servico} - ${apt.cliente_nome}
DESCRIPTION:Cliente: ${apt.cliente_nome}\\nTelefone: ${apt.cliente_telefone}\\nEmail: ${apt.cliente_email}\\nObserva√ß√µes: ${apt.observacoes || 'Nenhuma'}
END:VEVENT`;
            }).join('\n');

            const calendarContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Sal√£o de Beleza//Agendamentos//PT
${calendarEvents}
END:VCALENDAR`;

            const blob = new Blob([calendarContent], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'agendamentos.ics';
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Calend√°rio exportado com sucesso!');
        }

        // Send reminders
        function sendReminders() {
            if (!isAuthenticated) {
                showNotification('Acesso negado. Fa√ßa login primeiro.', 'error');
                return;
            }
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];
            
            const tomorrowAppointments = appointments.filter(apt => apt.data === tomorrowStr);
            
            if (tomorrowAppointments.length === 0) {
                showNotification('Nenhum agendamento para amanh√£.', 'error');
                return;
            }

            tomorrowAppointments.forEach(apt => {
                // Simulate email reminder
                console.log(`Email enviado para ${apt.cliente_email}: Lembrete do seu agendamento amanh√£ √†s ${apt.horario}`);
                
                // Simulate WhatsApp reminder
                const message = `Ol√° ${apt.cliente_nome}! Lembrando que voc√™ tem agendamento amanh√£ √†s ${apt.horario} - ${apt.servico}. Aguardamos voc√™! üíÑ‚ú®`;
                setTimeout(() => {
                    const whatsappUrl = `https://wa.me/${apt.cliente_telefone.replace(/\D/g, '')}?text=${encodeURIComponent(message)}`;
                    window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
                }, 1000);
            });

            showNotification(`${tomorrowAppointments.length} lembretes enviados!`);
        }

        // Format date
        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('pt-BR');
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99747534e67512fd',t:'MTc2MTkyNzM5Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
